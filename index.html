<!DOCTYPE html>
<html lang="ja" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mablデモアプリ</title>
    <!-- Tailwind CSSを読み込み (URLを https://cdn.tailwindcss.com に修正) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* bodyのマージンを強制的にリセット（Tailwindの読み込み失敗対策） */
        body {
            margin: 0;
        }

        /* PCでの閲覧用シミュレーション（中央配置スタイル）を削除 */

        /* メインのコンテナ */
        .mobile-container {
            width: 100%;
            /* max-width, border, box-shadow, border-radius を削除 */
            height: 100%; /* 100vhから100%に変更 (html, body が h-full のため) */
            overflow: hidden; /* スクロールを内部で管理 */
            display: flex;
            flex-direction: column;
            background-color: #ffffff;
        }
        /* PC閲覧用の固定高さ指定 (@media) を削除 */

        /* ヘッダー */
        .header {
            flex-shrink: 0;
            background-color: #4a90e2; /* mabl風の青 */
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            position: relative;
        }
        /* フッター（タブバー） */
        .footer-nav {
            flex-shrink: 0;
            border-top: 1px solid #e0e0e0;
            background-color: #f9f9f9;
            display: flex;
            justify-content: space-around;
        }
        .footer-nav button {
            flex: 1;
            padding: 0.75rem 0.5rem;
            font-size: 0.75rem;
            color: #666;
            border: none;
            background: none;
            cursor: pointer;
        }
        .footer-nav button.active {
            color: #4a90e2;
            font-weight: 600;
        }
        /* 画面コンテンツ領域 */
        .content {
            flex-grow: 1;
            overflow-y: auto; /* コンテンツが多い場合はスクロール */
            padding: 1.5rem;
        }
        /* 各画面のコンテナ */
        .screen {
            display: none; /* デフォルトは非表示 */
            height: 100%;
            flex-direction: column;
        }
        .screen.active {
            display: flex; /* アクティブな画面のみ表示 */
        }

        /* プロフィール画像用スタイル */
        .profile-image {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }
        .profile-image-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #4a90e2;
        }
        .upload-preview {
            display: none;
        }
        .upload-preview.active {
            display: block;
        }
    </style>
</head>
<body class="h-full m-0 bg-white"> <!-- ← bodyタグに m-0 クラスを追加 -->
    
    <div class="mobile-container">

        <!-- ===== 画面1: ログイン画面 ===== -->
        <div id="login-screen" class="screen active">
            <div class="header">
                <h1>ログイン</h1>
            </div>
            <div class="content space-y-6">
                <div class="text-center">
                    <!-- Visual Find / AIアサーション用のロゴ -->
                    <svg class="mx-auto h-12 w-auto text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121.88 12c0 5.176-4.91 9.34-11.3 9.34S.7 17.176.7 12c0-2.395 1.02-4.57 2.68-6.177" />
                    </svg>
                    <h2 class="mt-4 text-2xl font-bold tracking-tight text-gray-900">デモアプリへようこそ</h2>
                </div>
                
                <!-- 従来のテスト用フォーム -->
                <div class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium leading-6 text-gray-900">メールアドレス</label>
                        <div class="mt-2">
                            <input id="email" name="email" type="email" autocomplete="email" required class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6" placeholder="test@mabl.com">
                        </div>
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium leading-6 text-gray-900">パスワード</label>
                        <div class="mt-2">
                            <input id="password" name="password" type="password" autocomplete="current-password" required class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6" placeholder="password">
                        </div>
                    </div>
                    <!-- エラーメッセージ（アサーション用） -->
                    <div id="error-message" class="text-sm text-red-600 h-4"></div>
                </div>

                <div>
                    <!-- ログインボタン（ID自動修復テスト用） -->
                    <button id="login-button" type="button" class="flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                        ログイン
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== 画面2: ホーム画面 ===== -->
        <div id="home-screen" class="screen">
            <div class="header flex items-center justify-between px-4">
                <!-- プロフィール画像アイコン (アップロード機能追加後に表示) -->
                <div id="profile-icon-container" class="w-10">
                    <img id="profile-icon" src="https://placehold.co/40x40/CCCCCC/666666?text=U" alt="プロフィール" class="profile-image">
                </div>
                <h1 class="text-xl font-semibold text-white">ホーム</h1>
                <!-- カートアイコン (Visual Find用) -->
                <button aria-label="カート" class="text-white p-2 rounded-full hover:bg-blue-700">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.354 1.121-5.654 0-8.008H4.884c-1.121 2.354-1.121 5.654 0 8.008z" />
                    </svg>
                </button>
            </div>
            
            <div class="content space-y-6">
                <!-- アサーション用ウェルカムメッセージ -->
                <h2 id="welcome-message" class="text-2xl font-bold text-gray-800"></h2>
                
                <!-- AIアサーション / Visual Find用セクション -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-700">おすすめ商品</h3>
                    <!-- 商品1 -->
                    <div class="flex items-center space-x-4 rounded-lg border border-gray-200 p-4 shadow-sm">
                        <img src="https://placehold.co/80x80/4A90E2/FFFFFF?text=Item+1" alt="商品画像1" class="w-20 h-20 rounded-md object-cover flex-shrink-0">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900">高性能ヘッドフォン</h4>
                            <p class="text-sm text-gray-600">クリアな音質と快適な装着感。</p>
                            <p class="text-lg font-bold text-blue-600 mt-1">¥15,000</p>
                        </div>
                    </div>
                    <!-- 商品2（要素が少し異なる） -->
                    <div class="flex items-center space-x-4 rounded-lg border border-gray-200 p-4 shadow-sm">
                        <img src="https://placehold.co/80x80/34C759/FFFFFF?text=Item+2" alt="商品画像2" class="w-20 h-20 rounded-md object-cover flex-shrink-0">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900">スマートウォッチ</h4>
                            <!-- AIアサーション用：説明文が変動する可能性 -->
                            <p class="text-sm text-gray-600">健康管理と通知をこの一台で。</p>
                            <!-- AIアサーション用：価格が変動する可能性 -->
                            <p class="text-lg font-bold text-green-600 mt-1">¥28,000</p>
                        </div>
                    </div>
                     <!-- 商品3 -->
                    <div class="flex items-center space-x-4 rounded-lg border border-gray-200 p-4 shadow-sm" id="item-3">
                        <img src="https://placehold.co/80x80/FF9500/FFFFFF?text=Item+3" alt="商品画像3" class="w-20 h-20 rounded-md object-cover flex-shrink-0">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900">ポータブルスピーカー</h4>
                            <p class="text-sm text-gray-600">どこでも高音質。防水対応。</p>
                            <p class="text-lg font-bold text-orange-600 mt-1">¥8,500</p>
                        </div>
                    </div>
                </div>
            </div>

            <nav class="footer-nav">
                <button class="nav-button active" data-target="home-screen">ホーム</button>
                <button class="nav-button" data-target="settings-screen">設定</button>
            </nav>
        </div>

        <!-- ===== 画面3: 設定画面 ===== -->
        <div id="settings-screen" class="screen">
            <div class="header">
                <h1 class="text-xl font-semibold text-white">設定</h1>
            </div>

            <div class="content space-y-6">
                <h2 class="text-xl font-bold text-gray-800">アプリケーション設定</h2>

                <!-- プロフィール画像アップロードセクション (新規追加) -->
                <div class="rounded-lg border border-blue-300 bg-blue-50 p-4">
                    <h3 class="font-semibold text-blue-800">プロフィール画像</h3>
                    <div class="mt-4 flex flex-col items-center space-y-4">
                        <!-- 現在の画像プレビュー -->
                        <div class="text-center">
                            <img id="profile-preview" src="https://placehold.co/120x120/CCCCCC/666666?text=No+Image" alt="プロフィールプレビュー" class="profile-image-large mx-auto">
                            <p id="upload-status" class="mt-2 text-sm text-gray-600 h-4"></p>
                        </div>
                        
                        <!-- ファイル選択ボタン -->
                        <div class="w-full">
                            <label for="profile-upload" class="flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-blue-500 cursor-pointer">
                                画像を選択
                            </label>
                            <input id="profile-upload" type="file" accept="image/jpeg,image/png,image/gif" class="hidden">
                        </div>

                        <!-- アップロードされたファイル情報 -->
                        <div id="file-info" class="upload-preview w-full text-sm text-gray-700 bg-white p-3 rounded border border-gray-200">
                            <p><strong>ファイル名:</strong> <span id="file-name"></span></p>
                            <p><strong>サイズ:</strong> <span id="file-size"></span></p>
                            <p><strong>種類:</strong> <span id="file-type"></span></p>
                        </div>

                        <!-- エラーメッセージ -->
                        <div id="upload-error" class="upload-preview w-full text-sm text-red-600 bg-red-50 p-3 rounded border border-red-200"></div>
                    </div>
                </div>

                <!-- 自動修復デモ用 -->
                <div class="rounded-lg border border-yellow-300 bg-yellow-50 p-4">
                    <h3 class="font-semibold text-yellow-800">自動修復(Auto-heal)デモ</h3>
                    <p class="mt-2 text-sm text-yellow-700">
                        このボタンを押すと、ログイン画面の「ログイン」ボタンのHTML `id` が `login-button` から `login-btn-v2` に変わります。
                        mablがこの変更を検知し、テストを自動修復できるか試してみましょう。
                    </p>
                    <button id="change-id-button" class="mt-4 rounded-md bg-yellow-500 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-yellow-400">
                        ログインボタンのIDを変更
                    </button>
                    <p id="change-id-status" class="mt-2 text-sm text-gray-600 h-4"></p>
                </div>

                <!-- 従来のテスト用（ログアウト） -->
                <div class="mt-8">
                    <button id="logout-button" class="flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-red-500">
                        ログアウト
                    </button>
                </div>
            </div>

            <nav class="footer-nav">
                <button class="nav-button" data-target="home-screen">ホーム</button>
                <button class="nav-button active" data-target="settings-screen">設定</button>
            </nav>
        </div>

    </div>

    <script>
        // --- グローバル変数 ---
        const screens = document.querySelectorAll('.screen');
        const navButtons = document.querySelectorAll('.nav-button');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const errorMessage = document.getElementById('error-message');
        const welcomeMessage = document.getElementById('welcome-message');
        const changeIdButton = document.getElementById('change-id-button');
        const changeIdStatus = document.getElementById('change-id-status');
        const profileUpload = document.getElementById('profile-upload');
        const profilePreview = document.getElementById('profile-preview');
        const profileIcon = document.getElementById('profile-icon');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');
        const fileType = document.getElementById('file-type');
        const uploadStatus = document.getElementById('upload-status');
        const uploadError = document.getElementById('upload-error');

        let originalLoginButtonId = 'login-button';
        let currentProfileImage = null;

        // --- 関数定義 ---

        /**
         * 指定されたIDの画面を表示し、他を非表示にする
         * @param {string} screenId 表示する画面のID
         */
        function showScreen(screenId) {
            screens.forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');

            // フッターナビゲーションのアクティブ状態を更新
            navButtons.forEach(button => {
                if (button.dataset.target === screenId) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        }

        /**
         * ログイン処理
         */
        function handleLogin() {
            const email = emailInput.value;
            const password = passwordInput.value;

            if (email === 'test@mabl.com' && password === 'password') {
                // ログイン成功
                errorMessage.textContent = '';
                // ユーザー名を動的に設定（アサーション用）
                welcomeMessage.textContent = 'ようこそ、Demo Userさん';
                showScreen('home-screen');
                // フォームをクリア
                emailInput.value = '';
                passwordInput.value = '';
            } else {
                // ログイン失敗（アサーション用）
                errorMessage.textContent = 'メールアドレスまたはパスワードが違います。';
            }
        }

        /**
         * プロフィール画像のアップロード処理
         */
        function handleProfileUpload(event) {
            const file = event.target.files[0];
            
            // ファイルが選択されていない場合
            if (!file) {
                return;
            }

            // エラーメッセージをクリア
            uploadError.classList.remove('active');
            uploadError.textContent = '';

            // ファイルサイズチェック (5MB以下)
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                uploadError.textContent = 'ファイルサイズが大きすぎます。5MB以下のファイルを選択してください。';
                uploadError.classList.add('active');
                fileInfo.classList.remove('active');
                return;
            }

            // ファイル形式チェック
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
            if (!allowedTypes.includes(file.type)) {
                uploadError.textContent = '対応していないファイル形式です。JPEG、PNG、またはGIF形式の画像を選択してください。';
                uploadError.classList.add('active');
                fileInfo.classList.remove('active');
                return;
            }

            // ファイル情報を表示
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileType.textContent = file.type;
            fileInfo.classList.add('active');

            // 画像プレビューを表示
            const reader = new FileReader();
            reader.onload = function(e) {
                currentProfileImage = e.target.result;
                profilePreview.src = currentProfileImage;
                profileIcon.src = currentProfileImage;
                uploadStatus.textContent = 'アップロード完了';
                uploadStatus.classList.add('text-green-600');
                
                // 3秒後にステータスメッセージをクリア
                setTimeout(() => {
                    uploadStatus.textContent = '';
                    uploadStatus.classList.remove('text-green-600');
                }, 3000);
            };
            reader.readAsDataURL(file);
        }

        /**
         * ファイルサイズを読みやすい形式に変換
         */
        function formatFileSize(bytes) {
            if (bytes < 1024) {
                return bytes + ' B';
            } else if (bytes < 1024 * 1024) {
                return (bytes / 1024).toFixed(2) + ' KB';
            } else {
                return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
            }
        }

        /**
         * ログアウト処理
         */
        function handleLogout() {
            welcomeMessage.textContent = '';
            // プロフィール画像をリセット
            currentProfileImage = null;
            profilePreview.src = 'https://placehold.co/120x120/CCCCCC/666666?text=No+Image';
            profileIcon.src = 'https://placehold.co/40x40/CCCCCC/666666?text=U';
            fileInfo.classList.remove('active');
            uploadStatus.textContent = '';
            profileUpload.value = '';
            showScreen('login-screen');
        }

        /**
         * 自動修復デモ用：ログインボタンのIDを変更
         */
        function handleChangeId() {
            const currentLoginButton = document.getElementById(originalLoginButtonId);
            if (currentLoginButton) {
                const newId = 'login-btn-v2';
                currentLoginButton.id = newId;
                originalLoginButtonId = newId; // 次回のためにIDを更新
                changeIdStatus.textContent = `IDが "${newId}" に変更されました。`;
                console.warn(`ログインボタンのIDが ${newId} に変更されました。`);
            } else {
                changeIdStatus.textContent = 'ボタンは既に見つかりません。';
            }
        }

        // --- イベントリスナー ---

        // ログインボタン
        // 注意：IDが変わる可能性があるため、動的に要素を取得する
        document.body.addEventListener('click', function(event) {
            if (event.target.id === originalLoginButtonId) {
                handleLogin();
            }
        });

        // ログアウトボタン
        logoutButton.addEventListener('click', handleLogout);

        // ID変更ボタン
        changeIdButton.addEventListener('click', handleChangeId);

        // フッターナビゲーション
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetScreen = button.dataset.target;
                showScreen(targetScreen);
            });
        });

        // プロフィール画像アップロード
        profileUpload.addEventListener('change', handleProfileUpload);

        // 初期表示
        showScreen('login-screen');

    </script>

</body>
</html>